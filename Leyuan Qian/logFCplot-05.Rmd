---
title: "R Notebook"
output:
  word_document: default
  html_notebook: default
---

## Import libraries
```{r}

library(tidyverse, quietly = TRUE)
library(ggplot2)
library(ggthemes)
library(ggpubr)
library(stringr, quietly = TRUE)

```



## Download the data
```{r}
t7_DE = read.csv('t7_DE.csv', header=T, row.names=1, com='', check.names=F)
t16_DE = read.csv('t16_DE.csv', header=T, row.names=1, com='', check.names=F)
t7_DE
t16_DE
```



```{r}
t7_DEG <- rownames(subset(t7_DE, p.adjust(t7_DE$PValue, method="BH")<0.05))
t16_DEG <- rownames(subset(t16_DE, p.adjust(t16_DE$PValue, method="BH")<0.05))

total_DE_genes <- unique(c(t7_DEG,t16_DEG))

length(t7_DEG)
length(t16_DEG)
length(total_DE_genes)
```

```{r}
write.csv(t7_DEG,file = "t7_DEG.csv")
write.csv(t16_DEG,file = "t16_DEG.csv")
```


## Add a column "GeneID"
```{r}
t7_DE =rownames_to_column(t7_DE)
t16_DE =rownames_to_column(t16_DE)
colnames(t7_DE)[colnames(t7_DE)=="rowname"] = "GeneID"
colnames(t16_DE)[colnames(t16_DE)=="rowname"] = "GeneID"
```

## Add a column indicating whether the gene is DE at this dataset
```{r}
t7_DE$DE=0
t7_DE$DE[t7_DE$GeneID %in% t7_DEG] = 1
t7_DE

t16_DE$DE=0
t16_DE$DE[t16_DE$GeneID %in% t16_DEG] = 1

```

## Merge two datasets
```{r}
#Merge the tables(t3_full_DE_info and t12_full_DE_info)
combined_table <- inner_join(t7_DE,t16_DE,by="GeneID",suffix = c("_t7","_t16"))
combined_table <- combined_table[combined_table$GeneID %in% total_DE_genes,]
combined_table
#Add a column DE_color indicating de at which dataset
combined_table$DE_t7[combined_table$DE_t7==1]=2
combined_table$DE_t7 <- as.numeric(as.character(combined_table$DE_t7))
combined_table$DE_t16 <- as.numeric(as.character(combined_table$DE_t16))
combined_table$DE_color <- combined_table$DE_t7 + combined_table$DE_t16
combined_table$DE_color[combined_table$DE_color==2]="et7"
combined_table$DE_color[combined_table$DE_color==1]="et16"
combined_table$DE_color[combined_table$DE_color==3]="both"


```

```{r}
write.csv(combined_table,file="combined_table_t7t16.csv")

```


## Download the data
```{r}
Pulse_DE = read.csv('pulse_DE.csv', header=T, row.names=1, com='', check.names=F)
No_Pulse_DE = read.csv('no_pulse_DE.csv', header=T, row.names=1, com='', check.names=F)
Pulse_DE
No_Pulse_DE
```



```{r}
Pulse_DEG <- rownames(subset(Pulse_DE, p.adjust(Pulse_DE$PValue, method="BH")<0.05))
No_Pulse_DEG <- rownames(subset(No_Pulse_DE, p.adjust(No_Pulse_DE$PValue, method="BH")<0.05))

total_DE_genes2 <- unique(c(Pulse_DEG,No_Pulse_DEG))
length(Pulse_DEG)
length(No_Pulse_DEG)
length(total_DE_genes2)
```

```{r}

write.csv(Pulse_DEG,file = "Pulse_DEG.csv")
write.csv(No_Pulse_DEG,file = "No_Pulse_DEG.csv")
```


## Add a column "GeneID"
```{r}
Pulse_DE =rownames_to_column(Pulse_DE)
No_Pulse_DE =rownames_to_column(No_Pulse_DE)
colnames(Pulse_DE)[colnames(Pulse_DE)=="rowname"] = "GeneID"
colnames(No_Pulse_DE)[colnames(No_Pulse_DE)=="rowname"] = "GeneID"
```




## Add a column indicating whether the gene is DE at this dataset
```{r}
Pulse_DE$DE=0
Pulse_DE$DE[Pulse_DE$GeneID %in% Pulse_DEG] = 1
Pulse_DE

No_Pulse_DE$DE=0
No_Pulse_DE$DE[No_Pulse_DE$GeneID %in% No_Pulse_DEG] = 1

```


Find the overlapped genes in both figures
```{r}
overlap_both <- intersect(total_DE_genes,total_DE_genes2)
length(overlap_both)
```


## Add a column "overlap" indicating overlapped in both figures or not
```{r}

combined_table$overlap = "no"
combined_table$overlap[combined_table$GeneID %in% overlap_both]="yes"


```

## Explore genes that are DE at both datasets
```{r}
combined_table$GeneID[combined_table$DE_color=="both"]
```




## Find genes that are in the second quadrant of the cluster figure
```{r}
result1 <- combined_table$GeneID[combined_table$logFC_t7<0]
result2 <- combined_table$GeneID[combined_table$logFC_t16>0]
second_quadrant_first_figure <- unique(c(result1,result2))
length(second_quadrant_first_figure)
```

```{r}
result1
```


```{r}
result1 <- subset(combined_table[combined_table$logFC_t7<0,])
result1 

result2 <- subset(result1[result1$logFC_t16>0,])
result2 
```





```{r}
write.csv(result2,file="second_quadrant_t7t16.csv")
```



##ggplot
```{r}


plotA<-ggplot(combined_table, aes(x=logFC_t7, y=logFC_t16,color=DE_color, size=overlap)) +
  geom_point()+geom_hline(yintercept=0,color="black")+geom_vline(xintercept=0,color="black") + 
  scale_color_manual("Differential expressed at",values=c("red", "blue","green"),breaks = c("et7","et16","both"))+
  scale_size_manual("Overlapped in both figures",values = c(1,2),breaks=c("no","yes"))+
  scale_x_continuous(name="logFC (pulse vs no pulse) at et7", limits=c(-15, 15)) +
  scale_y_continuous(name="logFC (pulse vs no pulse) at et16",limits=c(-15,15))+
  theme(panel.grid = element_blank(),rect = element_blank(), axis.line = element_line(color = "grey"),text=element_text(size=12),legend.box.background = element_rect())

plotA
```








-----------------------------------------------------------------------------------------------------------------











## Merge two datasets
```{r}
#Merge the two datasets(Pulse_full_DE_info and No_Pulse_full_DE_info)
combined_table2 <- inner_join(Pulse_DE,No_Pulse_DE,by="GeneID",suffix = c("_Pulse","_No_Pulse"))
combined_table2 <- combined_table2[combined_table2$GeneID %in% total_DE_genes2,]

#Add a column indicating de at which dataset
combined_table2$DE_Pulse[combined_table2$DE_Pulse==1]=2
combined_table2$DE_Pulse <- as.numeric(as.character(combined_table2$DE_Pulse))
combined_table2$DE_No_Pulse <- as.numeric(as.character(combined_table2$DE_No_Pulse))
combined_table2$DE_color <- combined_table2$DE_Pulse + combined_table2$DE_No_Pulse
combined_table2$DE_color[combined_table2$DE_color==2]="Pulse"
combined_table2$DE_color[combined_table2$DE_color==1]="No Pulse"
combined_table2$DE_color[combined_table2$DE_color==3]="both"

combined_table2
```

```{r}
write.csv(combined_table2,file="combined_table_pulsenopulse.csv")
```


## Add a column "overlap" indicating overlapped in both figures or not
```{r}
combined_table2$overlap = "no"
combined_table2$overlap[combined_table2$GeneID %in% overlap_both]="yes"
```




## Explore genes that are DE at both datasets

```{r}
combined_table2$GeneID[combined_table2$DE_color=="both"]

```

## Find genes that are in the second quadrant of the cluster figure

```{r}
result3 <- subset(combined_table2[combined_table2$logFC_Pulse<0,])
result3 

result4 <- subset(result3[result3$logFC_No_Pulse>0,])
result4 
```
240/284

```{r}
write.csv(result4,file="second_quadrant_pulsenopulse.csv")
```


```{r}
#ggplot
plotB<-ggplot(combined_table2, aes(x=logFC_Pulse, y=logFC_No_Pulse, color=DE_color, size=overlap)) +
  geom_point(shape=1)+
  geom_hline(yintercept=0,color="black")+
  geom_vline(xintercept=0,color="black")  + 
  scale_color_manual("Differential Expressed at",values=c("red", "blue","green"),breaks = c("Pulse","No Pulse","both"))+
scale_size_manual("Overlapped in both figures",values = c(1,2),breaks=c("no","yes"))+
  scale_x_continuous(name="logFC (et7 vs et16) Pulse", limits=c(-15, 15)) +
  scale_y_continuous(name="logFC (et7 vs et16) No Pulse")+
  theme(panel.grid = element_blank(),rect = element_blank(), axis.line = element_line(color = "grey"),text=element_text(size=12),legend.box.background = element_rect())

plotB


```

--------------------------------------------------------------------------------------------------



```{r fig.width=8,fig.height=10}
plot <- ggarrange(plotA,plotB,labels=c("(A)","(B)"),nrow = 2,widths = 10,heights = 15)
plot

```


```{r fig.width=8,fig.height=10}
ggsave("Figure 6.png")

```

